
\chapter{Конструкторская часть}

\section{Требования к программному обеспечению}
Программа должна предоставлять следующие возможности:
\begin{enumerate}
	\item Задание положения источника света
	\item Изменения положения камеры и направления ее взгляда
	\item Визуализация трехмерных примитивов: шар, куб, цилиндр, конус
	\item Визуализация отражений, света и теней в соответствии с параметрами примитивов
	\item Поддержка перемещения и поворота заданных примитивов, а также изменения их цвета
	\item Изменения интенсивности источника света
\end{enumerate}

\section{Общий алгоритм построения изображения}
Рассмотрим алгоритм построения кадра, пока что не рассматривая конкретную реализацию алгоритма трассировки лучей на картинке~\ref{img:frame_algo}.




\includeimage
{frame_algo} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
{f} % Обтекание (без обтекания)
{H} % Положение рисунка (см. figure из пакета float)
{0.5\textwidth} % Ширина рисунка
{Общий алгоритм построения кадра} % Подпись рисунка




\section{Выбор типов и структур данных}
Для формирования общего алгоритма синтеза изображения, необходимо ввести определения соответствуюших структур
данных.
\begin{enumerate}
	\item Структура источника света описывается следующими полями:
	\begin{itemize}
		\item position --- вектор положения источника света в пространстве;
		\item intensivity --- интенсивность источника света по каждой составляющей RGB.
	\end{itemize}

	\item Структура камеры описывается следующими полями:
	\begin{itemize}
		\item position --- вектор положения камеры в пространстве;
		\item view --- вектор направления взгляда камеры;
		\item up --- текущий <<верхний>> вектор камеры;
		\item right --- текущий <<правый>> вектор каметры.
	\end{itemize}
	
	\item Структура материала объекта описывается следующими полями:
	\begin{itemize}
		\item Color --- цвет данного материала;
		\item kA --- коэффициент рассеянного освещения;
		\item kD --- коэффициент диффузного освещения;
		\item kS --- коэффициент спектрального освещения.
	\end{itemize}


	\item Структура луча описывается следующими полями:
	\begin{itemize}
		\item position --- точка, лежащая на данном луче;
		\item direction --- вектор задающий направление луча;
		\item t --- вещественное число, задающее точку на данном луче.
	\end{itemize}



	\item  Также вводится структура пересечения луча с примитивом:
	\begin{itemize}
		\item t --- вещественное число, задающее точку на трассируемом луче;
		\item point --- координаты точки пересечения луча с примитивом;
		\item normal --- нормаль данного примитива, проведенная из точки пересечения;
		\item material --- материал пересеченного примитива;
		\item tracedRay --- трассируемый луч.
	\end{itemize}

	\item Сцена представляет собой массив с заранее определенным масимальным числом примитивов.
	\item Примитивы задаются аналогично их формальному описанию, приведенному в \ref{sec:obj_formalasation}.
\end{enumerate}



\section{Алгоритм обратной трассировки лучей}
Схема алгоритма трассировки лучей для 1 пикселя приведена на рисунке~\ref{img:raytrace_saved}. Входными данными для него являются: описания примитивов,
интенсивность источника света, положение источника света, максимальное число отражений луча.


\includeimage
{raytrace_saved} % Имя файла без расширения (файл должен быть расположен в директории inc/img/)
{f} % Обтекание (без обтекания)
{H} % Положение рисунка (см. figure из пакета float)
{0.8\textwidth} % Ширина рисунка
{Схема алгоритма трассировки лучей для 1 пикселя} % Подпись рисунка

\newpage
Теоретически свет может отражаться бесконечно, введение ограничения на максимальное число поколений луча позволит ограничить время построения изображения,
получая  реалистичное поведение света. Введены отдельные условия для отображения источника света, данный объект описывается примитивом --- сферой и выделяется отдельно,
для предотвращений визуализации отражений от него.












\section*{Вывод}

В данном разделе была разобрана реализация выбранного алгоритма построения изображения, а также рассмотрены случаи поиска пересечений лучей  к конкретным примитивам. 
Была затронута тема построения перспективы для выбранного алгоритма и математическое обоснование его работы. Были описаны основные структуры данных, необходимы для решения поставленных задач.




