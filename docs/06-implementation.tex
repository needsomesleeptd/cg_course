\chapter{Технологическая часть}
В данной части рассматривается выбор средств реализации, описывается реализация алгоритмов и приводится интерфейс программного
обеспечения.

\section{Аппаратное ускорение}
Ввиду высокой трудоемкости построения изображения, для ускорения получения кадра и
парализации вычислений, была выбран OPENGL, позволяющий реализовать описанные алгоритмы на языке GLSL для реализации вычислений на графическом процессоре \cite{ray_trace_glsl}.

\section{Средства Реализации}
Для реализации описанных алгоритмов был язык \texttt{C++}, в силу следующих причин:
\begin{enumerate}
	\item в стандартной библиотеке языка присутствует поддержка всех структур данных,
	выбранных на этапе проектирования \cite{STL};
	\item существуют фреймворк для выбранного языка, позволяющий реализовать графический интерфейс \cite{qt_c++};
	\item язык позволяет использовать библиотеку для упрощения использования графического процессора \cite{qt_opengl}.
\end{enumerate}

В качестве среды разработки была выбрана среда разработки  CLion, так как она \cite{clion}:
\begin{enumerate}
    \item позволяет использовать утилиту CMake, что позволит конфигурировать проект независимо от платформы;
    \item поддерживает выделение glsl кода;
    \item обладает необходимым функционалом для сборки, профилирования и отладки программ.
\end{enumerate}


\section{Реализация алгоритмов}
В листинге \ref{lst:inter.frag} приведен код расчета пересечений с рассматриваемыми примитивами на языке glsl, данные функции принимают
параметры луча и примитива  и рассчитывают параметр $t$ точки пересечения луча, а также нормаль   в точке пересечения.
Аргументы функций, имеющие префикс --- \texttt{out} также являются результатом работы функции.
В переменную \texttt{normal} сохрается значение нормали в точке пересечение, в переменную \texttt{fraction} сохраняется 
значение параметра $t$ точки пересечения. Функция возврашает \texttt{true} в случае если пересечение с примитивом было обнаружено и \texttt{false}
иначе.
В листинге \ref{lst:phong.frag} приведена реализация  расчета интенсивности света 
луча с использованием модели Фонга.

В листинге \ref{lst:find_inter.frag} приведена реализация  поиска наиближайшего пересечения луча со всеми  примитивами сцены.

В листинге \ref{lst:trace.frag}  приведена реализация алгоритма трассировки лучей. 
Стоит отметить умножение интенсивности результирующего луча на 
коэффициент зеркального отражения
при каждом отражении, это необходимо для убывания интенсивности света при  столкновении луча  с примитивом,
так как часть энергии света будет поглощена. Также в данной реализации строиться луч к источнику света для
визуализации теней. Источник света представляет собой сферу, для предотвращения отражений от нее, в случае попадания в нее первичных~(не отраженных)
лучей цикл трассировки данного луча прекращается.












